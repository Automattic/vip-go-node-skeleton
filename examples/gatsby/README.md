# WordPress VIP Gatsby example

This is an example of a Gatsby application modified to meet [the requirements of WordPress VIP's platform](https://docs.wpvip.com/technical-references/node-js/#h-requirements). It was generated by following [Gatsby's "Quick Start" guide](https://www.gatsbyjs.com/docs/quick-start/), with only two changes:

1. The `start` script in `package.json` was modified to meet VIP requirements and the `serve` script was remove to avoid confusion.
   - The `-p $PORT` flag instructs the server to listen on a dynamic port, supplied by an environment variable. When `$PORT` is undefined (e.g., in local development) it falls back to a default (`9000`).
   - The `-H 0.0.0.0` flag instructs the server to listen on all local addresses. This is required on VIP.
2. A file was created at `./static/cache-healthcheck`. During the build, Gatsby copies this file into the `./public` directory, where it can be served as-is and satisfy VIP's healthcheck requirement.
   - Creating a "page" (e.g., `./src/pages/cache-healthcheck.js`) will not work, because Gatsby is strongly opinionated about enforcing trailing slashes. On VIP, your application must respond to requests to `/cache-healthcheck?` without the trailing slash. 
   - Plugins like [`gatsby-plugin-remove-trailing-slashes`](https://www.gatsbyjs.com/plugins/gatsby-plugin-remove-trailing-slashes/) will also not work, because they remove the trailing slash only on the client-side render; the server still responds with `301`. (You can confirm this with `curl -I "https://my-app.example.com/cache-healthcheck?"`.)
   - Gatsby's development server behaves differently than its production server, and will often respond with `200` in situations where the production server will not. Always test your application using a production build (`npm run build` and `npm start`).

